{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AutoFlow SPRINTS.yml Schema",
  "description": "Schema for validating SPRINTS.yml files",
  "type": "object",
  "required": ["project", "sprints"],
  "properties": {
    "project": {
      "type": "object",
      "required": ["name", "total_sprints", "last_updated"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Project name"
        },
        "total_sprints": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of sprints"
        },
        "current_sprint": {
          "type": ["integer", "null"],
          "minimum": 1,
          "description": "Current active sprint ID"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "Last update timestamp"
        }
      }
    },
    "sprints": {
      "type": "array",
      "description": "List of sprints",
      "items": {
        "type": "object",
        "required": ["id", "goal", "status", "total_effort", "max_effort", "last_updated", "deliverables", "tasks"],
        "properties": {
          "id": {
            "type": "integer",
            "minimum": 1,
            "description": "Sprint ID"
          },
          "goal": {
            "type": "string",
            "minLength": 1,
            "description": "Sprint goal"
          },
          "status": {
            "type": "string",
            "enum": [
              "PENDING",
              "WRITE_UNIT_TESTS",
              "WRITE_CODE",
              "CODE_REVIEW",
              "REVIEW_FIX",
              "RUN_UNIT_TESTS",
              "UNIT_FIX",
              "WRITE_E2E_TESTS",
              "RUN_E2E_TESTS",
              "E2E_FIX",
              "BLOCKED",
              "COMPLETE",
              "DONE"
            ],
            "description": "Current sprint status"
          },
          "duration": {
            "type": ["string", "null"],
            "description": "Sprint duration estimate"
          },
          "total_effort": {
            "type": "string",
            "pattern": "^\\d+h$",
            "description": "Total effort estimate (e.g., '8h')"
          },
          "max_effort": {
            "type": "string",
            "pattern": "^\\d+h$",
            "description": "Maximum effort allowed (e.g., '15h')"
          },
          "started": {
            "type": ["string", "null"],
            "format": "date-time",
            "description": "Sprint start timestamp"
          },
          "last_updated": {
            "type": "string",
            "format": "date-time",
            "description": "Last update timestamp"
          },
          "completed_at": {
            "type": ["string", "null"],
            "format": "date-time",
            "description": "Completion timestamp"
          },
          "deliverables": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "List of deliverables"
          },
          "tasks": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["id", "title", "effort", "priority", "feature", "docs", "business_rules", "testing"],
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^task-\\d{3}$",
                  "description": "Task ID (e.g., 'task-001')"
                },
                "title": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Task title"
                },
                "effort": {
                  "type": "string",
                  "pattern": "^\\d+h$",
                  "description": "Task effort estimate"
                },
                "priority": {
                  "type": "string",
                  "enum": ["HIGH", "MEDIUM", "LOW"],
                  "description": "Task priority"
                },
                "feature": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Feature name"
                },
                "docs": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Related documentation files"
                },
                "business_rules": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "string",
                    "minLength": 1
                  },
                  "description": "Business rules to implement"
                },
                "testing": {
                  "type": "object",
                  "required": ["unit_tests"],
                  "properties": {
                    "unit_tests": {
                      "type": "object",
                      "required": ["required", "reason"],
                      "properties": {
                        "required": {
                          "type": "boolean"
                        },
                        "reason": {
                          "type": "string",
                          "minLength": 1
                        }
                      }
                    },
                    "e2e_tests": {
                      "type": ["object", "null"],
                      "properties": {
                        "required": {
                          "type": "boolean"
                        },
                        "reason": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            },
            "description": "List of tasks"
          },
          "dependencies": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Sprint dependencies"
          },
          "integration_points": {
            "type": ["object", "null"],
            "properties": {
              "modifies": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "creates": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "tests_existing": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "patterns": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "blocked_count": {
            "type": ["integer", "null"],
            "minimum": 0
          },
          "must_complete_first": {
            "type": "boolean",
            "default": false
          }
        }
      }
    }
  }
}
